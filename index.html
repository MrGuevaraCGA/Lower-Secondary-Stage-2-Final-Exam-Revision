<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Science with Mr Guevara - Revision Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&family=Inter:wght@300;400;600&display=swap');

        /* CGA BRAND COLORS */
        :root {
            --cga-red: #990000;
            --cga-dark-red: #7a0000;
            --cga-gold: #FFC107;
            --cga-gray: #333333;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0fdf4;
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 20px 20px;
            color: #1F2937;
        }

        h1, h2, h3, h4, .brand-font {
            font-family: 'Montserrat', sans-serif;
        }

        /* 3D Button Styles */
        .btn-3d {
            transition: all 0.1s;
            box-shadow: 0px 4px 0px 0px rgba(0,0,0,0.2);
            transform: translateY(0);
        }
        .btn-3d:active {
            transform: translateY(4px);
            box-shadow: 0px 0px 0px 0px rgba(0,0,0,0.2);
        }
        
        .btn-3d-small {
            transition: all 0.1s;
            box-shadow: 0px 2px 0px 0px rgba(0,0,0,0.2);
            transform: translateY(0);
        }
        .btn-3d-small:active {
            transform: translateY(2px);
            box-shadow: 0px 0px 0px 0px rgba(0,0,0,0.2);
        }
        
        /* 3D Card Styles */
        .card-3d {
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1), 0 10px 0 rgba(0,0,0,0.05);
            border: 1px solid rgba(0,0,0,0.05);
        }
        .card-3d:hover {
            transform: translateY(-5px) scale(1.01);
            box-shadow: 0 10px 15px rgba(0,0,0,0.1), 0 15px 0 rgba(0,0,0,0.05);
        }

        /* Chart Container Styling */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }

        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        .custom-scroll::-webkit-scrollbar { width: 8px; }
        .custom-scroll::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #D1D5DB; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #9CA3AF; }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Navigation Tabs */
        .nav-btn {
            color: #E5E7EB;
            position: relative;
            text-shadow: 1px 1px 0 rgba(0,0,0,0.2);
        }
        .nav-btn:hover {
            color: var(--cga-gold);
            transform: scale(1.05);
        }
        .tab-btn-active {
            color: #FFFFFF !important;
            font-weight: 800;
            text-shadow: 0px 0px 10px rgba(255,255,255,0.5);
        }
        .tab-btn-active::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 100%;
            height: 6px;
            background-color: var(--cga-gold);
            border-radius: 3px 3px 0 0;
            box-shadow: 0 -2px 5px rgba(255, 193, 7, 0.5);
        }

        /* Flashcard Styles */
        .flashcard {
            perspective: 1000px;
            height: 220px;
        }
        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform-style: preserve-3d;
            border-radius: 1rem;
            cursor: pointer;
            box-shadow: 0 10px 0 rgba(0,0,0,0.1);
        }
        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            border-radius: 1rem;
        }
        .flashcard-front {
            background: linear-gradient(135deg, #ffffff 0%, #f3f4f6 100%);
            color: #1F2937;
            border: 2px solid #E5E7EB;
        }
        .flashcard-back {
            background: linear-gradient(135deg, #990000 0%, #7a0000 100%);
            color: white;
            transform: rotateY(180deg);
            border: 2px solid #7a0000;
            flex-direction: column;
        }

        /* Chat Widget Styles */
        #chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            font-family: 'Inter', sans-serif;
        }
        #chat-window {
            display: none;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            flex-direction: column;
            overflow: hidden;
            margin-bottom: 15px;
            border: 4px solid #990000;
            animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        #chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            background: #f9fafb;
        }
        .message {
            margin-bottom: 10px;
            padding: 10px 14px;
            border-radius: 16px;
            max-width: 85%;
            font-size: 0.9rem;
            line-height: 1.4;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .message.user {
            background-color: var(--cga-red);
            color: white;
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 2px;
        }
        .message.bot {
            background-color: #e5e7eb;
            color: #1f2937;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }
        
        /* Audio Player Styles */
        #audio-player-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #1f2937;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.3);
            display: none;
            align-items: center;
            gap: 15px;
            z-index: 200;
            border: 2px solid var(--cga-gold);
            animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .audio-wave {
            display: flex;
            align-items: center;
            gap: 3px;
            height: 20px;
        }
        .audio-wave span {
            display: block;
            width: 3px;
            background: var(--cga-gold);
            animation: wave 1s infinite ease-in-out;
        }
        .audio-wave span:nth-child(1) { animation-delay: 0.0s; height: 10px; }
        .audio-wave span:nth-child(2) { animation-delay: 0.1s; height: 20px; }
        .audio-wave span:nth-child(3) { animation-delay: 0.2s; height: 15px; }
        .audio-wave span:nth-child(4) { animation-delay: 0.3s; height: 20px; }
        .audio-wave span:nth-child(5) { animation-delay: 0.4s; height: 10px; }
        @keyframes wave {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(0.5); }
        }

        /* Typing Animation */
        .typing-indicator span {
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: #6b7280;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out both;
            margin: 0 1px;
        }
        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* AI Glow Effect */
        .ai-glow {
            animation: border-pulse 2s infinite;
        }
        @keyframes border-pulse {
            0% { border-color: #a855f7; box-shadow: 0 0 0 0 rgba(168, 85, 247, 0.4); }
            70% { border-color: #d8b4fe; box-shadow: 0 0 0 10px rgba(168, 85, 247, 0); }
            100% { border-color: #a855f7; box-shadow: 0 0 0 0 rgba(168, 85, 247, 0); }
        }

        /* ANIMATED DIAGRAM STYLES */
        .heart-beat { animation: heartBeat 1.2s infinite ease-in-out; }
        @keyframes heartBeat {
            0% { transform: scale(1); }
            15% { transform: scale(1.15); }
            30% { transform: scale(1); }
            45% { transform: scale(1.15); }
            60% { transform: scale(1); }
        }
        .blood-flow { animation: flow 2s linear infinite; }
        @keyframes flow {
            0% { transform: translateX(-100%); opacity: 0; }
            50% { opacity: 1; }
            100% { transform: translateX(100%); opacity: 0; }
        }
        .sperm-swim { animation: swim 3s linear infinite; }
        @keyframes swim {
            0% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(20px) translateY(-5px); }
            50% { transform: translateX(40px) translateY(5px); }
            75% { transform: translateX(60px) translateY(-5px); }
            100% { transform: translateX(80px) translateY(0); }
        }

        /* CGA Specific Utilities */
        .bg-cga-red { background-color: var(--cga-red); }
        .text-cga-red { color: var(--cga-red); }
        .text-cga-gold { color: var(--cga-gold); }
        .border-cga-gold { border-color: var(--cga-gold); }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navigation -->
    <nav class="bg-cga-red shadow-2xl sticky top-0 z-50 border-b-4 border-cga-dark-red">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col sm:flex-row justify-between h-auto sm:h-24 items-center py-3 sm:py-0">
                <div class="flex items-center mb-3 sm:mb-0 transform hover:scale-105 transition cursor-pointer" onclick="switchTab('home')" title="Go Home">
                    <div class="flex flex-col leading-tight group">
                         <span class="text-3xl font-extrabold text-white tracking-wide brand-font drop-shadow-md">SCIENCE WITH</span>
                         <span class="text-sm font-bold text-cga-gold tracking-widest uppercase group-hover:text-white transition">MR GUEVARA</span>
                    </div>
                    <div class="h-10 w-1 bg-white/20 mx-4 hidden sm:block rounded-full"></div>
                    <span class="text-white/90 font-bold text-lg hidden sm:block uppercase tracking-wider">Revision Hub</span>
                </div>
                <div class="flex flex-wrap justify-center gap-4">
                    <button onclick="switchTab('bio')" id="btn-bio" class="nav-btn text-base font-bold tracking-wide transition pb-2 uppercase">Biology</button>
                    <button onclick="switchTab('chem')" id="btn-chem" class="nav-btn text-base font-bold tracking-wide transition pb-2 uppercase">Chemistry</button>
                    <button onclick="switchTab('phys')" id="btn-phys" class="nav-btn text-base font-bold tracking-wide transition pb-2 uppercase">Physics</button>
                    <button onclick="switchTab('flash')" id="btn-flash" class="nav-btn text-base font-bold tracking-wide transition pb-2 flex items-center gap-1 uppercase"><span class="text-cga-gold animate-pulse">‚ö°</span> Quick Fire</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 w-full">
        
        <!-- Hero / Home Section -->
        <div id="hero-section" class="text-center py-12 fade-in">
            <div class="bg-white rounded-3xl p-10 shadow-xl border-b-8 border-gray-200 mb-10 card-3d">
                <h1 class="text-5xl md:text-6xl font-extrabold text-gray-900 mb-6 uppercase tracking-tight">
                    Welcome <span class="text-cga-red">Scientists!</span>
                </h1>
                <p class="text-xl text-gray-600 max-w-3xl mx-auto mb-10 font-medium">
                    This interactive hub is designed to help you ace your Stage 2 Final Exam.
                </p>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-left">
                    <div onclick="switchTab('bio')" class="cursor-pointer group hover:-translate-y-2 transition duration-300">
                        <div class="bg-green-100 rounded-2xl p-6 h-full border-2 border-green-200 hover:border-green-500 hover:shadow-xl">
                            <div class="text-4xl mb-4 group-hover:scale-110 transition duration-300 transform origin-left">üåø</div>
                            <h3 class="text-xl font-bold text-green-800 mb-2">Biology</h3>
                            <p class="text-sm text-green-700">Explore living things, cells, and body systems.</p>
                        </div>
                    </div>
                    <div onclick="switchTab('chem')" class="cursor-pointer group hover:-translate-y-2 transition duration-300">
                        <div class="bg-blue-100 rounded-2xl p-6 h-full border-2 border-blue-200 hover:border-blue-500 hover:shadow-xl">
                            <div class="text-4xl mb-4 group-hover:scale-110 transition duration-300 transform origin-left">üß™</div>
                            <h3 class="text-xl font-bold text-blue-800 mb-2">Chemistry</h3>
                            <p class="text-sm text-blue-700">Discover atoms, reactions, and matter.</p>
                        </div>
                    </div>
                    <div onclick="switchTab('phys')" class="cursor-pointer group hover:-translate-y-2 transition duration-300">
                        <div class="bg-yellow-100 rounded-2xl p-6 h-full border-2 border-yellow-200 hover:border-yellow-500 hover:shadow-xl">
                            <div class="text-4xl mb-4 group-hover:scale-110 transition duration-300 transform origin-left">‚ö°</div>
                            <h3 class="text-xl font-bold text-yellow-800 mb-2">Physics</h3>
                            <p class="text-sm text-yellow-700">Master forces, energy, and electricity.</p>
                        </div>
                    </div>
                    <div onclick="switchTab('flash')" class="cursor-pointer group hover:-translate-y-2 transition duration-300">
                        <div class="bg-purple-100 rounded-2xl p-6 h-full border-2 border-purple-200 hover:border-purple-500 hover:shadow-xl">
                            <div class="text-4xl mb-4 group-hover:scale-110 transition duration-300 transform origin-left">‚ö°</div>
                            <h3 class="text-xl font-bold text-purple-800 mb-2">Quick Fire</h3>
                            <p class="text-sm text-purple-700">Test yourself with AI-powered flashcards.</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex flex-wrap justify-center gap-6 mt-12">
                <button onclick="switchTab('bio')" class="btn-3d bg-green-500 hover:bg-green-600 text-white text-lg font-bold py-4 px-10 rounded-2xl">
                    üåø Start Biology
                </button>
                <button onclick="switchTab('chem')" class="btn-3d bg-blue-500 hover:bg-blue-600 text-white text-lg font-bold py-4 px-10 rounded-2xl">
                    üß™ Start Chemistry
                </button>
                <button onclick="switchTab('phys')" class="btn-3d bg-yellow-500 hover:bg-yellow-600 text-white text-lg font-bold py-4 px-10 rounded-2xl shadow-yellow-700">
                    ‚ö° Start Physics
                </button>
            </div>
        </div>

        <!-- ================= BIOLOGY SECTION ================= -->
        <div id="bio-section" class="hidden fade-in">
            <div class="bg-white rounded-3xl p-8 mb-10 border-l-8 border-green-500 shadow-lg card-3d flex flex-col md:flex-row justify-between items-center gap-4">
                <div>
                    <h2 class="text-4xl font-extrabold text-gray-900 mb-2 uppercase">üåø Biology: <span class="text-green-600">The Living World</span></h2>
                    <p class="text-lg text-gray-600 font-medium">Explore Life Processes, Cells, Systems, and Variation.</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="generateAudioLesson('Biology Overview')" class="btn-3d bg-green-600 text-white px-6 py-3 rounded-full font-bold flex items-center gap-2 hover:bg-green-700 text-sm">
                        üéß Overview
                    </button>
                </div>
            </div>

            <!-- Transcript Box -->
            <div id="Biology Overview-transcript" class="hidden mb-10 p-6 bg-green-50 rounded-2xl border-2 border-green-200 text-green-900 shadow-inner"></div>

            <div class="mb-10">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800 flex items-center">
                        <span class="bg-cga-red text-white py-1 px-4 rounded-xl text-sm uppercase tracking-wider mr-3 font-extrabold shadow-md transform -rotate-2">Core Concept</span> 
                        Characteristics of Life
                    </h3>
                    <button onclick="generateAudioLesson('Characteristics of Life MRS GREN')" class="btn-3d-small bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold border border-green-300">üéß Listen</button>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6" id="mrs-gren-container"></div>
                <div id="Characteristics of Life MRS GREN-transcript" class="hidden mt-4 p-4 bg-green-50 rounded-xl border border-green-200 text-sm"></div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
                <div class="bg-white rounded-3xl shadow-lg p-8 border-2 border-gray-100 card-3d">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
                        <h3 class="text-2xl font-bold text-gray-800">üî¨ Cell Explorer</h3>
                        <div class="flex gap-2">
                            <button onclick="generateAudioLesson('Cell Structures')" class="btn-3d-small bg-purple-100 text-purple-700 px-3 py-1 rounded-full border border-purple-200 font-bold text-xs">üéß Listen</button>
                            <button onclick="explainWithAnalogy('cells')" class="btn-3d-small bg-purple-100 text-purple-700 px-3 py-1 rounded-full border border-purple-200 hover:bg-purple-200 font-bold text-xs flex items-center gap-1">‚ú® Analogy</button>
                        </div>
                    </div>
                    <div id="Cell Structures-transcript" class="hidden mb-4 p-4 bg-purple-50 rounded-xl text-sm border border-purple-200"></div>
                    <div id="cells-analogy-output" class="hidden mb-6 p-5 bg-purple-50 rounded-2xl text-purple-900 border-2 border-purple-100 italic shadow-inner"></div>
                    <div class="flex space-x-3 mb-6 bg-gray-100 p-2 rounded-2xl">
                        <button onclick="updateCellView('animal')" id="btn-animal" class="flex-1 py-3 rounded-xl font-bold transition transform hover:scale-105">Animal Cell</button>
                        <button onclick="updateCellView('plant')" id="btn-plant" class="flex-1 py-3 rounded-xl font-bold transition transform hover:scale-105">Plant Cell</button>
                    </div>
                    <div id="cell-details" class="space-y-4 h-72 overflow-y-auto custom-scroll pr-2"></div>
                </div>

                <div class="bg-white rounded-3xl shadow-lg p-8 border-2 border-gray-100 card-3d">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-gray-800">üå± Plant Transport</h3>
                        <button onclick="generateAudioLesson('Plant Transport Xylem Phloem')" class="btn-3d-small bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold border border-green-300">üéß Listen</button>
                    </div>
                    <div id="Plant Transport Xylem Phloem-transcript" class="hidden mb-4 p-4 bg-green-50 rounded-xl text-sm border border-green-200"></div>
                    <div class="space-y-4">
                        <div class="p-6 bg-green-50 rounded-2xl border-l-8 border-green-500 hover:bg-green-100 transition transform hover:translate-x-2 cursor-pointer" onclick="alert('Xylem transports water and minerals from roots to leaves.')">
                            <h4 class="font-extrabold text-green-800 text-xl mb-1">üíß Xylem</h4>
                            <p class="text-gray-700 font-medium">Dead tubes. Transports <strong>Water & Minerals</strong> upwards only.</p>
                            <p class="text-xs text-green-600 mt-2 font-bold">Click for details</p>
                        </div>
                        <div class="p-6 bg-yellow-50 rounded-2xl border-l-8 border-yellow-500 hover:bg-yellow-100 transition transform hover:translate-x-2 cursor-pointer" onclick="alert('Phloem transports dissolved sugars (food) made in the leaves to other parts of the plant.')">
                            <h4 class="font-extrabold text-yellow-800 text-xl mb-1">üç¨ Phloem</h4>
                            <p class="text-gray-700 font-medium">Living tissue. Transports <strong>Food (Sugars)</strong> up and down.</p>
                            <p class="text-xs text-yellow-600 mt-2 font-bold">Click for details</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Organ Systems (UPDATED) -->
            <div class="bg-white rounded-3xl shadow-lg p-8 mb-10 border-2 border-gray-100 card-3d">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-2xl font-bold text-gray-800">ü´Ä Interactive Organ Systems</h3>
                    <button onclick="generateAudioLesson('Human Organ Systems')" class="btn-3d-small bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold border border-blue-300">üéß Listen</button>
                </div>
                <div id="Human Organ Systems-transcript" class="hidden mb-4 p-4 bg-blue-50 rounded-xl text-sm border border-blue-200"></div>
                <div class="grid grid-cols-1 md:grid-cols-12 gap-8">
                    <!-- Selector -->
                    <div class="md:col-span-4 space-y-3">
                        <button onclick="updateSystemDetail('respiratory')" class="btn-3d w-full text-left p-4 rounded-xl hover:bg-gray-50 font-bold transition border-2 border-gray-200 focus:outline-none system-btn" id="sys-btn-resp">ü´Å Respiratory</button>
                        <button onclick="updateSystemDetail('circulatory')" class="btn-3d w-full text-left p-4 rounded-xl hover:bg-gray-50 font-bold transition border-2 border-gray-200 focus:outline-none system-btn" id="sys-btn-circ">‚ù§Ô∏è Circulatory</button>
                        <button onclick="updateSystemDetail('skeletal')" class="btn-3d w-full text-left p-4 rounded-xl hover:bg-gray-50 font-bold transition border-2 border-gray-200 focus:outline-none system-btn" id="sys-btn-skel">üíÄ Skeletal & Muscle</button>
                        <button onclick="updateSystemDetail('repro')" class="btn-3d w-full text-left p-4 rounded-xl hover:bg-gray-50 font-bold transition border-2 border-gray-200 focus:outline-none system-btn" id="sys-btn-repro">üß¨ Reproduction</button>
                    </div>

                    <!-- Detail Panel -->
                    <div class="md:col-span-8 bg-gray-50 rounded-3xl p-8 border-2 border-gray-200 min-h-[350px] shadow-inner" id="system-detail-panel"></div>
                </div>
            </div>

            <!-- Genetics (UPDATED) -->
            <div class="bg-white rounded-3xl shadow-lg p-8 mb-8 border-2 border-gray-100 card-3d">
                 <div class="flex justify-between items-center mb-6">
                     <h3 class="text-2xl font-bold text-gray-800">üß¨ Genetics & Evolution</h3>
                     <div class="flex gap-2">
                        <button onclick="generateAudioLesson('Genetics and Natural Selection')" class="btn-3d-small bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-xs font-bold border border-gray-300">üéß Listen</button>
                        <button onclick="explainWithAnalogy('evolution')" class="btn-3d-small bg-purple-100 text-purple-700 px-3 py-1 rounded-full border border-purple-200 hover:bg-purple-200 font-bold text-xs flex items-center gap-1">‚ú® Analogy</button>
                     </div>
                 </div>
                 <div id="Genetics and Natural Selection-transcript" class="hidden mb-4 p-4 bg-gray-50 rounded-xl text-sm border border-gray-200"></div>
                 <div id="evolution-analogy-output" class="hidden mb-6 p-5 bg-purple-50 rounded-2xl text-purple-900 border-2 border-purple-100 italic shadow-inner"></div>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                     <div class="bg-gray-50 border-2 border-gray-200 p-6 rounded-2xl hover:border-cga-red transition cursor-pointer" onclick="alert('Variation is the differences between individuals. Inherited comes from genes (eye colour), environmental comes from lifestyle (scars).')">
                        <strong class="text-xl text-cga-red block mb-2">Variation</strong>
                        <ul class="text-base list-disc list-inside text-gray-700 space-y-2 font-medium">
                            <li><strong>Inherited:</strong> Eye colour, Genes.</li>
                            <li><strong>Environmental:</strong> Scars, Tattoos, Accent.</li>
                        </ul>
                        <p class="text-xs text-gray-500 mt-2 text-right">Click for definition</p>
                     </div>
                     <div class="bg-gray-50 border-2 border-gray-200 p-6 rounded-2xl hover:border-cga-red transition cursor-pointer" onclick="alert('Natural selection is the process where organisms better adapted to their environment tend to survive and produce more offspring.')">
                        <strong class="text-xl text-cga-red block mb-2">Natural Selection</strong>
                        <p class="text-base text-gray-700 leading-relaxed font-medium">"Survival of the fittest". Helpful traits (Adaptations) -> Survival -> Reproduction -> Passing on genes.</p>
                        <p class="text-xs text-gray-500 mt-2 text-right">Click for definition</p>
                     </div>
                 </div>
            </div>
        </div>

        <!-- ================= CHEMISTRY SECTION ================= -->
        <div id="chem-section" class="hidden fade-in">
            <div class="bg-white rounded-3xl p-8 mb-10 border-l-8 border-blue-500 shadow-lg card-3d flex justify-between items-center">
                <div>
                    <h2 class="text-4xl font-extrabold text-gray-900 mb-2 uppercase">üß™ Chemistry: <span class="text-blue-600">Matter & Reactions</span></h2>
                    <p class="text-lg text-gray-600 font-medium">Particles, Mixtures, Reactions, Acids, Earth.</p>
                </div>
                <button onclick="generateAudioLesson('Chemistry Overview')" class="btn-3d bg-blue-600 text-white px-6 py-3 rounded-full font-bold flex items-center gap-2 hover:bg-blue-700 text-sm">
                    üéß Listen & Learn
                </button>
            </div>

            <!-- Transcript Box -->
            <div id="Chemistry Overview-transcript" class="hidden mb-10 p-6 bg-blue-50 rounded-2xl border-2 border-blue-200 text-blue-900 shadow-inner"></div>
            
            <div class="bg-white rounded-3xl shadow-lg p-8 mb-8 border-2 border-gray-100 card-3d">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
                    <h3 class="text-2xl font-bold text-gray-800">üß± The Building Blocks</h3>
                    <div class="flex gap-2">
                        <button onclick="generateAudioLesson('Elements Compounds Mixtures')" class="btn-3d-small bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold border border-blue-300">üéß Listen</button>
                        <button onclick="generateMystery()" class="btn-3d text-sm bg-purple-600 text-white px-6 py-3 rounded-full hover:bg-purple-700 font-bold flex items-center gap-2 shadow-lg transform hover:-rotate-2">üß© Solve a Mystery</button>
                    </div>
                </div>
                <div id="Elements Compounds Mixtures-transcript" class="hidden mb-4 p-4 bg-blue-50 rounded-xl text-sm border border-blue-200"></div>
                <div id="mystery-output" class="hidden mb-8 p-6 bg-purple-50 rounded-2xl text-purple-900 border-2 border-purple-200 italic shadow-inner text-lg"></div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="p-6 bg-gray-50 rounded-2xl border-2 border-gray-100 hover:border-blue-400 transition transform hover:-translate-y-1 cursor-pointer" onclick="alert('Element: A substance made of only one type of atom.')">
                        <div class="text-5xl mb-3">ü™ô</div>
                        <h4 class="text-xl font-bold mb-1">Element</h4>
                        <p class="text-sm text-gray-600 font-medium">Pure substance. One type of atom.</p>
                        <p class="text-xs text-blue-400 mt-2 font-bold">Click info</p>
                    </div>
                    <div class="p-6 bg-blue-50 rounded-2xl border-2 border-blue-200 hover:shadow-xl transition transform hover:-translate-y-1 cursor-pointer" onclick="alert('Compound: A substance made of two or more different elements chemically bonded.')">
                        <div class="text-5xl mb-3">üîó</div>
                        <h4 class="text-xl font-bold mb-1">Compound</h4>
                        <p class="text-sm text-gray-600 font-medium">Two or more elements <strong>chemically bonded</strong>.</p>
                        <div class="mt-4 p-3 bg-white rounded-xl text-xs border border-blue-100 shadow-sm font-bold text-blue-800">Magic: Sodium + Chlorine = Salt üßÇ</div>
                        <p class="text-xs text-blue-600 mt-2 font-bold">Click info</p>
                    </div>
                    <div class="p-6 bg-gray-50 rounded-2xl border-2 border-gray-100 hover:border-blue-400 transition transform hover:-translate-y-1 cursor-pointer" onclick="alert('Mixture: A substance made by mixing other substances together without any chemical bonding.')">
                        <div class="text-5xl mb-3">ü•£</div>
                        <h4 class="text-xl font-bold mb-1">Mixture</h4>
                        <p class="text-sm text-gray-600 font-medium">Substances together but <strong>not bonded</strong>.</p>
                        <p class="text-xs text-blue-400 mt-2 font-bold">Click info</p>
                    </div>
                </div>
            </div>

            <!-- Particle Theory -->
            <div class="bg-white rounded-3xl shadow-lg p-8 mb-8 border-2 border-gray-100 card-3d">
                <div class="flex justify-between items-center mb-8">
                    <h3 class="text-2xl font-bold text-gray-800">‚öõÔ∏è Particle Party</h3>
                    <div class="flex gap-2">
                        <button onclick="generateAudioLesson('Particle Theory')" class="btn-3d-small bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-xs font-bold border border-gray-300">üéß Listen</button>
                        <button onclick="explainWithAnalogy('particles')" class="btn-3d-small bg-purple-100 text-purple-700 px-3 py-1 rounded-full border border-purple-200 hover:bg-purple-200 font-bold text-xs flex items-center gap-1">‚ú® Analogy</button>
                    </div>
                </div>
                <div id="Particle Theory-transcript" class="hidden mb-4 p-4 bg-gray-50 rounded-xl text-sm border border-gray-200"></div>
                <div id="particles-analogy-output" class="hidden mb-6 p-5 bg-purple-50 rounded-2xl text-purple-900 border-2 border-purple-100 italic shadow-inner"></div>
                <div class="mb-8 p-8 bg-gray-50 rounded-3xl border-2 border-gray-200 text-center relative overflow-hidden">
                    <h4 class="font-bold text-gray-500 mb-6 uppercase text-xs tracking-[0.2em]">Interactive States of Matter</h4>
                    <div class="flex flex-col md:flex-row justify-center items-center gap-10">
                        <div class="btn-3d w-40 p-5 bg-white rounded-2xl text-center cursor-pointer hover:bg-blue-50 transition border-2 border-gray-100" onclick="alert('Solid: Particles packed close together in a regular pattern. They vibrate in fixed positions.')"><div class="text-5xl mb-2">üßä</div><strong class="text-lg">Solid</strong></div>
                        <div class="flex flex-col gap-2 text-xs font-black text-gray-400 uppercase tracking-wide"><span class="text-red-500">Melting ‚û°Ô∏è</span><span class="text-blue-500">‚¨ÖÔ∏è Freezing</span></div>
                        <div class="btn-3d w-40 p-5 bg-white rounded-2xl text-center cursor-pointer hover:bg-blue-50 transition border-2 border-gray-100" onclick="alert('Liquid: Particles close together but arranged randomly. They can slide past each other.')"><div class="text-5xl mb-2">üíß</div><strong class="text-lg">Liquid</strong></div>
                        <div class="flex flex-col gap-2 text-xs font-black text-gray-400 uppercase tracking-wide"><span class="text-red-500">Evaporation ‚û°Ô∏è</span><span class="text-blue-500">‚¨ÖÔ∏è Condensation</span></div>
                        <div class="btn-3d w-40 p-5 bg-white rounded-2xl text-center cursor-pointer hover:bg-blue-50 transition border-2 border-gray-100" onclick="alert('Gas: Particles far apart and arranged randomly. They move quickly in all directions.')"><div class="text-5xl mb-2">üí®</div><strong class="text-lg">Gas</strong></div>
                    </div>
                </div>
            </div>

            <!-- Air & pH -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <div class="bg-white rounded-3xl shadow-lg p-8 border-2 border-gray-100 card-3d">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">üí® Air Composition (%)</h3>
                    <div class="chart-container"><canvas id="airChart"></canvas></div>
                </div>
                <div class="bg-white rounded-3xl shadow-lg p-8 border-2 border-gray-100 card-3d">
                    <h3 class="text-xl font-bold text-gray-800 mb-6">‚öñÔ∏è pH Scale Slider</h3>
                    <div class="relative pt-6 pb-2"><input type="range" min="0" max="14" value="7" class="w-full h-6 rounded-full appearance-none cursor-pointer shadow-inner border-2 border-gray-200" id="ph-slider" style="background: linear-gradient(to right, #ef4444 0%, #ef4444 45%, #22c55e 50%, #3b82f6 55%, #3b82f6 100%);"></div>
                    <div class="text-center p-6 bg-gray-50 rounded-2xl mt-6 border-2 border-gray-100 transition-colors duration-300" id="ph-display-box">
                        <div class="text-6xl font-black mb-2 transition-colors duration-300" id="ph-value">pH 7</div>
                        <div class="text-2xl font-bold mb-2 uppercase tracking-wide" id="ph-type" style="color: #22c55e;">Neutral</div>
                        <p class="text-gray-500 font-medium" id="ph-example">Example: Pure Water</p>
                    </div>
                    <div id="corrosive-warning" class="hidden mt-4 bg-red-100 text-red-800 p-4 rounded-xl border-2 border-red-200 flex items-center justify-center animate-bounce font-bold"><span class="text-3xl mr-3">‚ö†Ô∏è</span><span>Warning: Corrosive!</span></div>
                </div>
            </div>

            <!-- Earth Resources -->
            <div class="bg-white rounded-3xl shadow-lg p-8 mb-8 border-2 border-gray-100 card-3d">
                 <div class="flex justify-between items-center mb-6">
                     <h3 class="text-2xl font-bold text-gray-800">üåç Energy Resources Explorer</h3>
                     <button onclick="generateAudioLesson('Energy Resources')" class="btn-3d-small bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold border border-green-300">üéß Listen</button>
                 </div>
                 <div id="Energy Resources-transcript" class="hidden mb-4 p-4 bg-green-50 rounded-xl text-sm border border-green-200"></div>
                 <p class="text-gray-600 mb-6 font-medium">Tap a card to reveal the truth!</p>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                     <div class="btn-3d border-4 border-green-100 bg-white rounded-3xl p-6 cursor-pointer" onclick="toggleResource('renewable')">
                         <div class="flex items-center mb-3"><div class="bg-green-100 p-3 rounded-full mr-4 text-3xl">‚ôªÔ∏è</div><h4 class="text-xl font-bold text-green-800">Renewable Energy</h4></div>
                         <p class="text-base text-gray-600 font-medium">Infinite. Replenished naturally.</p>
                         <div id="renewable-details" class="hidden text-sm bg-green-50 p-4 rounded-xl mt-4 space-y-2 border-2 border-green-200 text-green-900"><p>‚òÄÔ∏è <strong>Solar:</strong> Sunlight -> Panels.</p><p>üå¨Ô∏è <strong>Wind:</strong> Turns turbines.</p><p>üíß <strong>Hydro:</strong> Falling water.</p><p>üåã <strong>Geothermal:</strong> Earth heat.</p></div>
                         <div class="text-center text-green-400 text-xs font-bold mt-4 uppercase tracking-widest">Tap to Expand</div>
                     </div>
                     <div class="btn-3d border-4 border-gray-100 bg-white rounded-3xl p-6 cursor-pointer" onclick="toggleResource('non-renewable')">
                         <div class="flex items-center mb-3"><div class="bg-gray-200 p-3 rounded-full mr-4 text-3xl">üõ¢Ô∏è</div><h4 class="text-xl font-bold text-gray-800">Non-Renewable</h4></div>
                         <p class="text-base text-gray-600 font-medium">Finite. Will run out.</p>
                         <div id="non-renewable-details" class="hidden text-sm bg-gray-100 p-4 rounded-xl mt-4 space-y-2 border-2 border-gray-200 text-gray-900"><p>‚¨õ <strong>Fossil Fuels:</strong> Coal, Oil, Gas.<br><span class="text-red-600 font-bold text-xs">‚ö†Ô∏è Releases CO‚ÇÇ (Global Warming)</span></p><p>‚ò¢Ô∏è <strong>Nuclear:</strong> Uranium.<br><span class="text-orange-600 font-bold text-xs">‚ö†Ô∏è Radioactive Waste</span></p></div>
                         <div class="text-center text-gray-400 text-xs font-bold mt-4 uppercase tracking-widest">Tap to Expand</div>
                     </div>
                 </div>
            </div>
        </div>

        <!-- ================= PHYSICS SECTION ================= -->
        <div id="phys-section" class="hidden fade-in">
            <div class="bg-white rounded-3xl p-8 mb-10 border-l-8 border-yellow-500 shadow-lg card-3d flex justify-between items-center">
                <div>
                    <h2 class="text-4xl font-extrabold text-gray-900 mb-2 uppercase">‚ö° Physics: <span class="text-yellow-600">Forces & Energy</span></h2>
                    <p class="text-lg text-gray-600 font-medium">Forces, Pressure, Electricity & Energy Stores.</p>
                </div>
                <button onclick="generateAudioLesson('Physics Overview')" class="btn-3d bg-yellow-500 text-white px-6 py-3 rounded-full font-bold flex items-center gap-2 hover:bg-yellow-600 text-sm shadow-yellow-700">
                    üéß Listen & Learn
                </button>
            </div>

            <!-- Transcript Box -->
            <div id="Physics Overview-transcript" class="hidden mb-10 p-6 bg-yellow-50 rounded-2xl border-2 border-yellow-200 text-yellow-900 shadow-inner"></div>

            <!-- Forces -->
             <div class="bg-white rounded-3xl shadow-lg p-8 mb-8 border-2 border-gray-100 card-3d">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">üöÄ Forces Fundamentals</h3>
                    <div class="flex gap-2">
                        <button onclick="generateAudioLesson('Forces and Friction')" class="btn-3d-small bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold border border-blue-300">üéß Listen</button>
                        <button onclick="explainWithAnalogy('forces')" class="btn-3d-small bg-purple-100 text-purple-700 px-3 py-1 rounded-full border border-purple-200 hover:bg-purple-200 font-bold text-xs flex items-center gap-1">‚ú® Analogy</button>
                    </div>
                </div>
                <div id="Forces and Friction-transcript" class="hidden mb-4 p-4 bg-blue-50 rounded-xl text-sm border border-blue-200"></div>
                <div id="forces-analogy-output" class="hidden mb-6 p-5 bg-purple-50 rounded-2xl text-purple-900 border-2 border-purple-100 italic shadow-inner"></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-6">
                        <div class="bg-gray-50 p-6 rounded-2xl border-2 border-gray-200 cursor-pointer" onclick="alert('A force is a push or a pull acting on an object.')"><strong class="text-lg text-gray-900">Definition:</strong> <p class="text-gray-600 mt-1">A Push or Pull. Measured in <strong>Newtons (N)</strong>.</p><p class="text-xs text-gray-400 mt-2 text-right">Click for definition</p></div>
                        <div class="bg-blue-50 p-6 rounded-2xl border-2 border-blue-100 cursor-pointer" onclick="alert('Gravity is a non-contact attractive force that pulls objects toward the center of the Earth.')"><strong class="text-lg text-blue-900">Gravity:</strong><p class="text-blue-700 mt-1">Non-contact pull towards Earth's center. Gives objects Weight.</p><p class="text-xs text-blue-300 mt-2 text-right">Click for definition</p></div>
                        <div class="bg-orange-50 p-6 rounded-2xl border-2 border-orange-100 cursor-pointer" onclick="alert('Friction is a contact force that opposes motion between two surfaces that are touching.')"><strong class="text-lg text-orange-900">Friction:</strong><p class="text-orange-700 mt-1">Opposes motion between touching surfaces.</p><div class="flex gap-2 mt-3"><span class="text-xs bg-white px-2 py-1 rounded border border-orange-200">üî• Heat</span><span class="text-xs bg-white px-2 py-1 rounded border border-orange-200">üõë Slows Down</span></div><p class="text-xs text-orange-300 mt-2 text-right">Click for definition</p></div>
                    </div>
                     <div class="bg-gray-800 text-white p-8 rounded-3xl shadow-inner border-4 border-gray-700 relative overflow-hidden">
                        <div class="absolute top-0 right-0 p-4 opacity-10 text-9xl">‚öñÔ∏è</div>
                        <h4 class="text-xl font-bold text-yellow-400 mb-6 relative z-10">Space Weight Calculator ü™ê</h4>
                        <div class="space-y-6 text-sm relative z-10">
                            <div class="grid grid-cols-2 gap-4">
                                <div><label class="text-xs uppercase tracking-wide text-gray-400 font-bold">Mass (kg):</label><input type="number" id="mass-input" value="50" oninput="updateWeightChart()" class="w-full mt-2 p-3 rounded-xl text-gray-900 font-bold border-4 border-gray-600 focus:border-yellow-400 outline-none text-lg"></div>
                                <div><label class="text-xs uppercase tracking-wide text-gray-400 font-bold">Location:</label><select id="planet-selector" onchange="updateWeightChart()" class="w-full mt-2 p-3 rounded-xl text-gray-900 font-bold border-4 border-gray-600 focus:border-yellow-400 outline-none cursor-pointer"><option value="1.6">üåë Moon (1.6)</option><option value="3.7">üî¥ Mars (3.7)</option><option value="24.8">üü† Jupiter (24.8)</option><option value="8.87">üåï Venus (8.9)</option><option value="274">‚òÄÔ∏è Sun (274!)</option></select></div>
                            </div>
                            <div class="bg-gray-700 p-3 rounded-xl text-center font-mono text-lg text-yellow-300 border-2 border-yellow-500/50">Weight = Mass √ó <span id="gravity-display">1.6</span></div>
                            <div class="h-40 relative"><canvas id="weightChart"></canvas></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Pressure -->
             <div class="bg-white rounded-3xl shadow-lg p-8 mb-8 border-2 border-gray-100 card-3d">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">üìç Pressure</h3>
                    <button onclick="generateAudioLesson('Pressure and Area')" class="btn-3d-small bg-gray-100 text-gray-700 px-3 py-1 rounded-full text-xs font-bold border border-gray-300">üéß Listen</button>
                </div>
                <div id="Pressure and Area-transcript" class="hidden mb-4 p-4 bg-gray-50 rounded-xl text-sm border border-gray-200"></div>
                <div class="flex flex-col md:flex-row items-center gap-8">
                    <div class="flex-1 text-center bg-red-50 p-6 rounded-3xl w-full border-2 border-red-100 transform hover:scale-105 transition cursor-pointer" onclick="alert('High Pressure: A large force over a small area (like a knife edge) creates high pressure.')"><div class="text-5xl mb-3">üî™</div><h4 class="font-bold text-xl text-gray-800">Sharp Knife</h4><p class="text-sm text-gray-600 mt-1">Small Area</p><div class="mt-3 text-red-600 font-black text-2xl uppercase tracking-wider">High Pressure</div></div>
                    <div class="font-black text-3xl text-gray-300">VS</div>
                    <div class="flex-1 text-center bg-blue-50 p-6 rounded-3xl w-full border-2 border-blue-100 transform hover:scale-105 transition cursor-pointer" onclick="alert('Low Pressure: A force spread over a large area (like a snowshoe or blunt object) creates low pressure.')"><div class="text-5xl mb-3">ü•Ñ</div><h4 class="font-bold text-xl text-gray-800">Blunt Spoon</h4><p class="text-sm text-gray-600 mt-1">Large Area</p><div class="mt-3 text-blue-600 font-black text-2xl uppercase tracking-wider">Low Pressure</div></div>
                </div>
            </div>

            <!-- Electricity -->
            <div class="bg-white rounded-3xl shadow-lg p-8 mb-8 border-2 border-gray-100 card-3d">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4">
                    <h3 class="text-2xl font-bold text-gray-800">üí° Electricity Explorer</h3>
                    <div class="flex gap-2">
                        <button onclick="generateAudioLesson('Electricity and Circuits')" class="btn-3d-small bg-yellow-100 text-yellow-700 px-3 py-1 rounded-full text-xs font-bold border border-yellow-300">üéß Listen</button>
                        <button onclick="explainWithAnalogy('circuits')" class="btn-3d text-sm bg-purple-100 text-purple-700 px-6 py-2 rounded-xl border-2 border-purple-200 hover:bg-purple-200 font-bold flex items-center gap-2">‚ú® AI Analogy</button>
                    </div>
                </div>
                <div id="Electricity and Circuits-transcript" class="hidden mb-4 p-4 bg-yellow-50 rounded-xl text-sm border border-yellow-200"></div>
                <div id="circuits-analogy-output" class="hidden mb-8 p-6 bg-purple-50 rounded-2xl text-purple-900 border-2 border-purple-200 italic shadow-inner"></div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="space-y-4">
                        <div class="p-5 bg-yellow-50 rounded-2xl border-2 border-yellow-200 shadow-sm"><strong class="text-yellow-900 text-lg">Current (Amps)</strong><p class="text-yellow-800 text-sm mt-1">Flow of electrons.</p></div>
                        <div class="p-5 bg-red-50 rounded-2xl border-2 border-red-200 shadow-sm"><strong class="text-red-900 text-lg">Resistance (Ohms)</strong><p class="text-red-800 text-sm mt-1">Opposes current. <br>More Resistance = Less Flow.</p></div>
                    </div>
                    <div class="space-y-4">
                        <div class="btn-3d border-4 border-yellow-100 bg-white rounded-2xl p-5 cursor-pointer flex justify-between items-center" onclick="toggleCircuitInfo('series')"><div><strong class="text-lg text-gray-800">Series Circuit üîó</strong><p class="text-xs text-gray-500 mt-1">1 Path. If 1 breaks, all break.</p></div><span class="text-3xl">üö´</span></div>
                        <div id="series-extra" class="hidden p-4 bg-gray-50 rounded-xl text-sm border-2 border-gray-200">Current is the same everywhere in a series circuit.</div>
                        <div class="btn-3d border-4 border-green-100 bg-white rounded-2xl p-5 cursor-pointer flex justify-between items-center" onclick="toggleCircuitInfo('parallel')"><div><strong class="text-lg text-gray-800">Parallel Circuit üõ§Ô∏è</strong><p class="text-xs text-gray-500 mt-1">Multiple Paths. House wiring.</p></div><span class="text-3xl">‚ú®</span></div>
                        <div id="parallel-extra" class="hidden p-4 bg-gray-50 rounded-xl text-sm border-2 border-gray-200">If one component breaks, the others stay on.</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ================= FLASHCARDS SECTION ================= -->
        <div id="flash-section" class="hidden fade-in">
             <div class="bg-white shadow-lg rounded-3xl p-10 mb-10 border-t-8 border-cga-gold text-center card-3d">
                <h2 class="text-4xl font-extrabold text-cga-red mb-4 uppercase">‚ö° Quick Fire Revision</h2>
                <p class="text-lg text-gray-600 mb-8 font-medium">Flip the cards to test your knowledge, or generate a new mystery question!</p>
                <button onclick="generateFlashcard()" id="gen-flash-btn" class="btn-3d bg-purple-600 hover:bg-purple-700 text-white text-lg px-8 py-4 rounded-full font-bold shadow-xl flex items-center gap-3 mx-auto transform hover:scale-105">
                    <span>‚ú®</span> Generate AI Question
                </button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="flashcards-container">
                <!-- Flashcards injected via JS -->
            </div>
        </div>

    </main>

    <!-- Chat Widget -->
    <div id="chat-widget">
        <div id="chat-window" class="flex flex-col">
            <div class="bg-cga-red text-white p-4 font-bold flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <span class="text-2xl">ü§ñ</span>
                    <span>Mr. Guevara Bot</span>
                </div>
                <button onclick="toggleChat()" class="text-white hover:text-gray-200 text-xl font-bold">‚úï</button>
            </div>
            <div id="chat-messages" class="flex-1 overflow-y-auto p-4 bg-gray-50">
                <div class="message bot">
                    Hello! üëã I am <strong>Mr. Guevara Bot version</strong> ü§ñ. 
                    <br><br>
                    I'm not the real Mr. Guevara (he's way cooler!), but until you see him in class, you can ask me anything about Science!
                </div>
            </div>
            <div class="p-3 bg-white border-t border-gray-200 flex">
                <input type="text" id="chat-input" placeholder="Type your question..." class="flex-1 border-2 border-gray-200 rounded-l-xl p-3 focus:outline-none focus:border-cga-red text-sm font-medium" onkeypress="handleChatKey(event)">
                <button onclick="askMrGuevara()" class="bg-cga-red text-white px-6 py-2 rounded-r-xl font-bold hover:bg-red-800 transition shadow-md">Send</button>
            </div>
        </div>
        <button onclick="toggleChat()" id="chat-toggle-btn" class="bg-cga-red text-white w-16 h-16 rounded-full shadow-2xl flex items-center justify-center font-bold text-3xl hover:bg-red-800 transition transform hover:scale-110 ml-auto block border-4 border-white ring-2 ring-cga-gold">
            üí¨
        </button>
    </div>

    <!-- Audio Player Bar -->
    <div id="audio-player-bar">
        <div class="audio-wave"><span></span><span></span><span></span><span></span><span></span></div>
        <span id="audio-status-text" class="text-sm font-bold">Teacher speaking...</span>
        <button onclick="stopAudio()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-full text-xs font-bold transition">STOP</button>
    </div>

    <!-- Footer -->
    <footer class="bg-cga-gray text-white py-12 mt-auto text-center border-t-8 border-cga-gold">
        <p class="font-extrabold text-2xl brand-font tracking-wide mb-2">SCIENCE WITH <span class="text-cga-gold">MR GUEVARA</span></p>
        <p class="text-gray-400 text-sm">Stage 2 Science Revision Tool ‚Ä¢ Powered by Gemini AI</p>
    </footer>

    <script>
        // --- API CONFIGURATION ---
        const apiKey = "AIzaSyATCE6-2DNac9wdKzQJlFQeYnYA-_f8XCQ"; 

        async function callGeminiAPI(prompt, systemInstruction = "") {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) return null;

                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text;
            } catch (error) {
                console.error("API Error:", error);
                return null;
            }
        }

        // --- AUDIO CONTROLLER ---
        function speakText(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel(); // Stop any previous
                
                const playAudio = () => {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 1.0; 
                    utterance.pitch = 1.0;
                    
                    const voices = window.speechSynthesis.getVoices();
                    
                    // robust search for male voices
                    const maleVoice = voices.find(v => 
                        v.name.toLowerCase().includes('male') || 
                        v.name.toLowerCase().includes('david') || 
                        v.name.toLowerCase().includes('daniel') || 
                        v.name.toLowerCase().includes('mark') || 
                        v.name.toLowerCase().includes('google us english') // Often default male on Chrome
                    );
                    
                    if (maleVoice) utterance.voice = maleVoice;

                    utterance.onstart = () => {
                        document.getElementById('audio-player-bar').style.display = 'flex';
                    };
                    utterance.onend = () => {
                        document.getElementById('audio-player-bar').style.display = 'none';
                    };

                    window.speechSynthesis.speak(utterance);
                };

                // Handle async voice loading (common in Chrome)
                if (window.speechSynthesis.getVoices().length === 0) {
                    window.speechSynthesis.onvoiceschanged = playAudio;
                } else {
                    playAudio();
                }

            } else {
                alert("Sorry, your browser doesn't support text-to-speech.");
            }
        }

        function stopAudio() {
            window.speechSynthesis.cancel();
            document.getElementById('audio-player-bar').style.display = 'none';
        }

        async function generateAudioLesson(topic) {
            // Check if transcript box exists for this topic (it might not for every sub-topic, fallback to generic if needed)
            let transcriptBox = document.getElementById(`${topic}-transcript`);
            if (!transcriptBox) {
                // If specific ID not found, maybe show it in a modal or creating a dynamic one?
                // For simplicity in this implementation, we will alert if not found or reuse a main one.
                // Better approach: Use the main section transcript box if specific one absent.
                // Assuming specific boxes exist for the main buttons added.
                return;
            }

            transcriptBox.classList.remove('hidden');
            transcriptBox.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div> <em>Preparing audio lesson...</em>`;

            const prompt = `Explain the key concepts of ${topic} (Level: 14 year old Science Student) for an auditory learner. Be conversational, clear, and engaging. Include one "Secret Tip" or fun fact to help remember it. Max 80 words. IMPORTANT: Do NOT introduce yourself. Do NOT say "I am Mr. Guevara". Jump straight into the science topics.`;
            
            const text = await callGeminiAPI(prompt, "You are a knowledgeable, energetic science tutor.");
            
            if (text) {
                transcriptBox.innerHTML = `<strong>üéß Audio Transcript:</strong><br><br>${marked.parse(text)}`;
                const cleanText = text.replace(/[*#]/g, ''); 
                speakText(cleanText);
            } else {
                transcriptBox.innerHTML = "Sorry, audio generation failed.";
            }
        }

        // --- NAVIGATION ---
        function switchTab(tabId) {
            stopAudio();
            document.querySelectorAll('main > div').forEach(el => el.classList.add('hidden'));
            
            ['bio', 'chem', 'phys', 'flash'].forEach(id => {
                const btn = document.getElementById(`btn-${id}`);
                if(btn) btn.classList.remove('tab-btn-active');
            });

            if (tabId === 'home') {
                document.getElementById('hero-section').classList.remove('hidden');
            } else {
                document.getElementById(`${tabId}-section`).classList.remove('hidden');
                const activeBtn = document.getElementById(`btn-${tabId}`);
                if(activeBtn) activeBtn.classList.add('tab-btn-active');
                
                if(tabId === 'chem' && window.airChartInstance) window.airChartInstance.resize();
                if(tabId === 'phys' && window.weightChartInstance) window.weightChartInstance.resize();
            }
            window.scrollTo(0, 0);
        }

        // --- AI FEATURES ---
        function toggleChat() {
            const window = document.getElementById('chat-window');
            const btn = document.getElementById('chat-toggle-btn');
            if (window.style.display === 'flex') {
                window.style.display = 'none';
                btn.style.display = 'flex';
            } else {
                window.style.display = 'flex';
                btn.style.display = 'none';
            }
        }

        function handleChatKey(e) {
            if (e.key === 'Enter') askMrGuevara();
        }

        async function askMrGuevara() {
            const input = document.getElementById('chat-input');
            const messages = document.getElementById('chat-messages');
            const text = input.value.trim();
            if (!text) return;

            messages.innerHTML += `<div class="message user">${text}</div>`;
            input.value = '';
            messages.scrollTop = messages.scrollHeight;

            const loadingId = 'loading-' + Date.now();
            messages.innerHTML += `<div class="message bot typing-indicator" id="${loadingId}"><span></span><span></span><span></span></div>`;
            messages.scrollTop = messages.scrollHeight;

            const systemPrompt = "You are 'Mr. Guevara Bot', a fun, AI version of a science teacher. Explain concepts in Biology, Chemistry, and Physics simply for 14-year-olds (Lower Secondary Stage 2). Keep answers concise (under 50 words). Use emojis!";
            const reply = await callGeminiAPI(text, systemPrompt);

            document.getElementById(loadingId).remove();
            
            if (reply) {
                const msgDiv = document.createElement('div');
                msgDiv.className = 'message bot';
                msgDiv.innerHTML = marked.parse(reply);
                messages.appendChild(msgDiv);
            } else {
                messages.innerHTML += `<div class="message bot">Oops! My circuits are jammed. Try again later!</div>`;
            }
            messages.scrollTop = messages.scrollHeight;
        }

        async function explainWithAnalogy(topic) {
            // Reuse existing output divs or create specific ones if needed.
            // For the new buttons, we need to target specific output areas.
            // This simple version targets pre-defined IDs.
            let outputId = "";
            let prompt = "";

            if (topic === 'cells') {
                prompt = "Explain cell parts (nucleus, mitochondria, cell membrane) using a fun analogy like a City or School. Simple for 13-14 year olds.";
                outputId = "cells-analogy-output";
            } else if (topic === 'circuits') {
                prompt = "Explain electrical current, voltage, resistance using a water pipe analogy. Simple for 13-14 year olds.";
                outputId = "circuits-analogy-output";
            } else if (topic === 'evolution') {
                prompt = "Explain Natural Selection using a simple analogy (like giraffes or moths).";
                outputId = "evolution-analogy-output";
            } else if (topic === 'particles') {
                prompt = "Explain states of matter (solid, liquid, gas) using an analogy like students in a classroom or dancers.";
                outputId = "particles-analogy-output";
            } else if (topic === 'forces') {
                prompt = "Explain forces and friction using a fun analogy like ice skating or sliding.";
                outputId = "forces-analogy-output";
            }

            const outputDiv = document.getElementById(outputId);
            if(outputDiv) {
                outputDiv.classList.remove('hidden');
                outputDiv.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div> Thinking...`;

                const response = await callGeminiAPI(prompt, "You are a creative science teacher.");
                if (response) {
                    outputDiv.innerHTML = `<strong>‚ú® Analogy:</strong><br>${marked.parse(response)}`;
                } else {
                    outputDiv.innerHTML = "Sorry, I couldn't generate an analogy right now.";
                }
            }
        }

        async function generateFlashcard() {
            const container = document.getElementById('flashcards-container');
            const btn = document.getElementById('gen-flash-btn');
            
            const originalText = btn.innerHTML;
            btn.innerHTML = "‚ú® Generating...";
            btn.disabled = true;

            const prompt = "Generate a single, unique revision question for Lower Secondary Stage 2 Science (Age 13-14). Topics: Biology (Cells, Systems), Chemistry (Atoms, Acids), Physics (Forces, Energy). IMPORTANT: Keep question text UNDER 20 WORDS. Simple concepts only. No advanced formulas. Output ONLY raw JSON: {\"q\": \"Question\", \"a\": \"Answer\"}.";
            
            try {
                const text = await callGeminiAPI(prompt);
                if (!text) throw new Error("No response text");

                let jsonStr = text.replace(/```json/g, '').replace(/```/g, '').trim();
                const firstBrace = jsonStr.indexOf('{');
                const lastBrace = jsonStr.lastIndexOf('}');
                if (firstBrace !== -1 && lastBrace !== -1) {
                    jsonStr = jsonStr.substring(firstBrace, lastBrace + 1);
                }

                const data = JSON.parse(jsonStr);

                const cardHtml = `
                <div class="flashcard" onclick="this.classList.toggle('flipped')">
                    <div class="flashcard-inner">
                        <div class="flashcard-front shadow-md border-2 border-purple-200 bg-purple-50">
                            <div class="absolute top-2 right-2 text-xs text-purple-600 font-bold">‚ú® AI GENERATED</div>
                            <h4 class="text-xl font-bold text-gray-900 px-4 flex items-center justify-center h-full">${data.q}</h4>
                            <span class="absolute bottom-4 text-xs text-purple-500 font-bold tracking-widest">TAP TO FLIP</span>
                        </div>
                        <div class="flashcard-back shadow-lg bg-purple-600 border-purple-600 flex flex-col justify-center">
                            <p class="text-xl font-bold text-white px-4">${data.a}</p>
                        </div>
                    </div>
                </div>`;
                
                container.insertAdjacentHTML('afterbegin', cardHtml);

            } catch (e) {
                console.error("Flashcard Error:", e);
                alert("Oops! The AI got confused. Try again.");
            }

            btn.innerHTML = originalText;
            btn.disabled = false;
        }

        async function generateMystery() {
            const output = document.getElementById('mystery-output');
            output.classList.remove('hidden');
            output.innerHTML = `<div class="typing-indicator"><span></span><span></span><span></span></div> üß© Investigating...`;

            const prompt = "Generate a short Science Mystery for a 13-year-old. Identify a substance using simple tests (pH, magnet, floating). Max 40 words. Ask 'What is it?' at the end.";
            const response = await callGeminiAPI(prompt, "You are a mystery narrator.");
            
            if (response) {
                output.innerHTML = `<strong>üïµÔ∏è Mystery Case:</strong><br>${marked.parse(response)}`;
            } else {
                output.innerHTML = "Case file missing. Try again later.";
            }
        }

        // --- STATIC DATA & INIT ---
        const mrsGrenData = [
            { letter: 'M', title: 'Movement', desc: 'Changing position.' },
            { letter: 'R', title: 'Respiration', desc: 'Releasing energy (NOT breathing).' },
            { letter: 'S', title: 'Sensitivity', desc: 'Reacting to surroundings.' },
            { letter: 'C', title: 'Control', desc: 'Homeostasis (Body Temp).' },
            { letter: 'G', title: 'Growth', desc: 'Increasing in size.' },
            { letter: 'R', title: 'Reproduction', desc: 'Making offspring.' },
            { letter: 'E', title: 'Excretion', desc: 'Removing waste (CO2, Urea).' },
            { letter: 'N', title: 'Nutrition', desc: 'Eating food.' }
        ];

        const flashcards = [
            {q: "Life Process removing waste?", a: "Excretion"},
            {q: "Plant cell part for support?", a: "Cell Wall"},
            {q: "Transports water in plants?", a: "Xylem"},
            {q: "Organ system with Heart?", a: "Circulatory"},
            {q: "Separating Sand & Water?", a: "Filtration"},
            {q: "Energy stored in food?", a: "Chemical"},
            {q: "Connects Baby to Mother?", a: "Placenta"},
            {q: "pH less than 7?", a: "Acid"},
            {q: "Unit of Force?", a: "Newtons (N)"},
            {q: "Skeleton protecting brain?", a: "Skull"},
            {q: "One loop circuit?", a: "Series"},
            {q: "Respiration Location?", a: "Mitochondria"},
            {q: "Particles far apart?", a: "Gas"},
            {q: "Force opposing motion?", a: "Friction"}
        ];

        const cellData = {
            animal: [
                { name: 'Nucleus', func: 'Controls cell', icon: 'üß†' },
                { name: 'Cytoplasm', func: 'Reactions happen here', icon: 'üíß' },
                { name: 'Cell Membrane', func: 'Controls entry/exit', icon: 'üõ°Ô∏è' },
                { name: 'Mitochondria', func: 'Energy Release', icon: '‚ö°' }
            ],
            plant: [
                { name: 'Nucleus', func: 'Controls cell', icon: 'üß†' },
                { name: 'Cytoplasm', func: 'Reactions happen here', icon: 'üíß' },
                { name: 'Cell Membrane', func: 'Controls entry/exit', icon: 'üõ°Ô∏è' },
                { name: 'Mitochondria', func: 'Energy Release', icon: '‚ö°' },
                { name: 'Cell Wall', func: 'Support (Cellulose)', icon: 'üß±', special: true },
                { name: 'Vacuole', func: 'Rigid & Sap', icon: 'üßä', special: true },
                { name: 'Chloroplasts', func: 'Photosynthesis', icon: 'üçÉ', special: true }
            ]
        };

        const detailedSystemData = {
            respiratory: {
                title: "Respiratory System",
                content: `<div class="space-y-6 text-gray-800 animate-fadeIn">
                    <p class="font-bold text-lg">Gas Exchange: Oxygen IN, Carbon Dioxide OUT.</p>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white p-4 rounded-2xl border-2 border-gray-100 shadow-sm hover:scale-105 transition cursor-pointer" onclick="alert('Trachea: The windpipe.')"><strong class="text-indigo-600 block mb-1">Trachea</strong>Windpipe with rings.</div>
                        <div class="bg-white p-4 rounded-2xl border-2 border-gray-100 shadow-sm hover:scale-105 transition cursor-pointer" onclick="alert('Bronchi: The two main branches leading to the lungs.')"><strong class="text-indigo-600 block mb-1">Bronchi</strong>Branches to lungs.</div>
                        <div class="bg-white p-4 rounded-2xl border-2 border-gray-100 shadow-sm hover:scale-105 transition cursor-pointer" onclick="alert('Lungs: The main organs of the respiratory system.')"><strong class="text-indigo-600 block mb-1">Lungs</strong>Main organs.</div>
                        <div class="bg-white p-4 rounded-2xl border-2 border-gray-100 shadow-sm hover:scale-105 transition cursor-pointer" onclick="alert('Diaphragm: A large muscle that helps you breathe.')"><strong class="text-indigo-600 block mb-1">Diaphragm</strong>Muscle sheet below.</div>
                    </div>
                    <div class="bg-blue-50 p-5 rounded-2xl border-2 border-blue-200 text-sm">
                        <strong>‚ö†Ô∏è Critical Distinction:</strong> 
                        <br>üí® <strong>Breathing:</strong> Physical movement of air (Muscles). 
                        <br>‚ö° <strong>Respiration:</strong> Chemical reaction for Energy (Mitochondria).
                    </div>
                </div>`
            },
            circulatory: {
                title: "Circulatory System",
                content: `<div class="space-y-6 text-gray-800 animate-fadeIn">
                    <p class="font-bold text-lg">Transport network moving Oxygen & Nutrients.</p>
                    <div class="flex justify-center items-center py-4"><div class="text-5xl heart-beat">‚ù§Ô∏è</div></div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center text-sm font-bold">
                        <div class="bg-red-100 p-4 rounded-2xl border-2 border-red-200 hover:scale-105 transition cursor-pointer" onclick="alert('The Heart pumps blood around the body.')"><span class="text-2xl block mb-2">‚ù§Ô∏è</span>Heart<br><span class="font-normal text-xs">The Pump</span></div>
                        <div class="bg-red-100 p-4 rounded-2xl border-2 border-red-200 hover:scale-105 transition cursor-pointer" onclick="alert('Blood carries oxygen and nutrients.')"><span class="text-2xl block mb-2">ü©∏</span>Blood<br><span class="font-normal text-xs">The Medium</span></div>
                        <div class="bg-red-100 p-4 rounded-2xl border-2 border-red-200 hover:scale-105 transition cursor-pointer" onclick="alert('Blood vessels are tubes that carry blood.')"><span class="text-2xl block mb-2">üõ£Ô∏è</span>Vessels<br><span class="font-normal text-xs">The Tubes</span></div>
                    </div>
                    <div class="bg-white p-4 rounded-2xl border-2 border-gray-100 relative overflow-hidden h-16 flex items-center"><div class="absolute w-full h-1 bg-red-200 top-1/2 -mt-0.5"></div><div class="w-4 h-4 bg-red-500 rounded-full blood-flow absolute top-1/2 -mt-2"></div><div class="w-4 h-4 bg-red-500 rounded-full blood-flow absolute top-1/2 -mt-2" style="animation-delay: 0.5s"></div><div class="w-4 h-4 bg-red-500 rounded-full blood-flow absolute top-1/2 -mt-2" style="animation-delay: 1s"></div><span class="relative z-10 bg-white px-2 text-xs font-bold text-gray-500 ml-2">Blood Flow</span></div>
                </div>`
            },
            skeletal: {
                title: "Skeletal & Muscular",
                content: `<div class="space-y-6 text-gray-800 animate-fadeIn">
                    <ul class="list-disc list-inside space-y-2 bg-white p-6 rounded-2xl border-2 border-gray-100 font-medium">
                        <li class="cursor-pointer hover:text-orange-600" onclick="alert('The skull protects the brain.')"><strong>Protection:</strong> Skull (Brain), Ribs (Heart).</li>
                        <li class="cursor-pointer hover:text-orange-600" onclick="alert('The skeleton provides a frame.')"><strong>Support:</strong> Frame holds you up.</li>
                        <li class="cursor-pointer hover:text-orange-600" onclick="alert('Bones act as levers for muscles.')"><strong>Movement:</strong> Bones act as levers.</li>
                    </ul>
                    <div class="bg-orange-50 p-6 rounded-2xl border-2 border-orange-200 text-center">
                        <strong class="text-orange-900 block mb-2">Antagonistic Pairs</strong>
                        <p class="text-sm text-orange-800 mb-4">Muscles work in pairs: One contracts, one relaxes.</p>
                        <div class="flex justify-center gap-4">
                            <span class="bg-white px-3 py-1 rounded shadow text-xs font-bold cursor-pointer hover:bg-orange-100" onclick="alert('Biceps get shorter!')">Biceps Contract üí™</span>
                            <span class="text-gray-400">vs</span>
                            <span class="bg-white px-3 py-1 rounded shadow text-xs font-bold cursor-pointer hover:bg-orange-100" onclick="alert('Triceps get longer!')">Triceps Relax</span>
                        </div>
                    </div>
                </div>`
            },
            repro: {
                title: "Reproduction",
                content: `<div class="space-y-6 text-gray-800 animate-fadeIn">
                    <div class="bg-pink-50 p-6 rounded-2xl border-2 border-pink-200 text-center cursor-pointer hover:bg-pink-100 transition" onclick="alert('The placenta allows substances to pass between mother and baby without mixing blood.')">
                        <strong class="text-pink-900 block mb-2">The Placenta</strong>
                        <p class="text-sm text-pink-800">Lifeline connecting mother & baby.</p>
                        <div class="flex justify-center gap-4 mt-3 text-xs font-bold">
                            <span class="bg-white px-2 py-1 rounded text-green-600">‚úÖ Oxygen</span>
                            <span class="bg-white px-2 py-1 rounded text-green-600">‚úÖ Food</span>
                            <span class="bg-white px-2 py-1 rounded text-red-500">‚ùå Waste</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 text-center text-xs">
                        <div class="bg-white p-2 rounded-xl border border-gray-200 cursor-pointer hover:bg-gray-50" onclick="alert('LH triggers the release of an egg.')"><strong>LH</strong><br>Ovulation</div>
                        <div class="bg-white p-2 rounded-xl border border-gray-200 cursor-pointer hover:bg-gray-50" onclick="alert('Oestrogen repairs the uterus lining.')"><strong>Oestrogen</strong><br>Repair Lining</div>
                        <div class="bg-white p-2 rounded-xl border border-gray-200 cursor-pointer hover:bg-gray-50" onclick="alert('Progesterone maintains the uterus lining.')"><strong>Progesterone</strong><br>Maintain Lining</div>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-2xl border-2 border-blue-100 relative h-20 overflow-hidden"><div class="absolute right-4 top-1/2 -mt-4 text-4xl">ü•ö</div><div class="absolute left-0 top-1/2 -mt-2 text-xl sperm-swim">„Ä∞Ô∏ètadpole</div><div class="text-xs text-center relative z-10 font-bold text-blue-300 mt-1">Fertilisation Race</div></div>
                </div>`
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            initBio();
            initChem();
            initPhys();
            initFlashcards();
            switchTab('home'); // START ON HOME SCREEN
        });

        function initBio() {
            const container = document.getElementById('mrs-gren-container');
            container.innerHTML = mrsGrenData.map(item => `
                <div class="flashcard" onclick="this.classList.toggle('flipped')">
                    <div class="flashcard-inner">
                        <div class="flashcard-front shadow-md bg-white border-b-4 border-green-500 rounded-2xl">
                            <div class="flex flex-col items-center">
                                <span class="text-6xl font-black text-green-500 mb-2">${item.letter}</span>
                                <span class="text-sm font-bold text-gray-400 uppercase tracking-widest">Flip Me</span>
                            </div>
                        </div>
                        <div class="flashcard-back shadow-lg bg-green-600 border-green-700 flex flex-col justify-center rounded-2xl">
                            <h4 class="text-2xl font-bold text-white mb-2">${item.title}</h4>
                            <p class="text-sm text-green-100 px-4">${item.desc}</p>
                        </div>
                    </div>
                </div>
            `).join('');
            updateCellView('animal');
        }

        function updateCellView(type) {
            const container = document.getElementById('cell-details');
            const btnAnimal = document.getElementById('btn-animal');
            const btnPlant = document.getElementById('btn-plant');

            if (type === 'animal') {
                btnAnimal.className = 'flex-1 py-3 bg-green-100 text-green-800 shadow-inner rounded-xl font-bold';
                btnPlant.className = 'flex-1 py-3 bg-white text-gray-500 hover:bg-gray-50 rounded-xl font-medium';
            } else {
                btnPlant.className = 'flex-1 py-3 bg-green-100 text-green-800 shadow-inner rounded-xl font-bold';
                btnAnimal.className = 'flex-1 py-3 bg-white text-gray-500 hover:bg-gray-50 rounded-xl font-medium';
            }

            container.innerHTML = cellData[type].map(part => `
                <div class="flex items-center p-4 rounded-xl mb-3 ${part.special ? 'bg-green-50 border-2 border-green-200' : 'bg-gray-50 border-2 border-gray-100'} animate-fadeIn transform hover:scale-105 transition cursor-pointer" onclick="alert('${part.func}')">
                    <span class="text-3xl mr-4">${part.icon}</span>
                    <div>
                        <span class="font-bold text-gray-800 block text-lg">${part.name}</span>
                        <span class="text-sm text-gray-600 font-medium">${part.func}</span>
                    </div>
                </div>
            `).join('');
        }

        function updateSystemDetail(sysId) {
            const data = detailedSystemData[sysId];
            document.getElementById('system-detail-panel').innerHTML = `
                <h3 class="text-3xl font-extrabold text-gray-800 mb-6 border-b-4 border-gray-100 pb-4">${data.title}</h3>
                ${data.content}
            `;
            document.querySelectorAll('.system-btn').forEach(b => b.classList.remove('bg-gray-100', 'border-cga-red'));
            document.querySelector(`button[onclick="updateSystemDetail('${sysId}')"]`).classList.add('bg-gray-100', 'border-cga-red');
        }

        function initChem() {
            const ctx = document.getElementById('airChart').getContext('2d');
            window.airChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Nitrogen', 'Oxygen', 'Argon', 'CO2'],
                    datasets: [{ data: [78, 21, 0.9, 0.1], backgroundColor: ['#3B82F6', '#EF4444', '#10B981', '#F59E0B'], borderWidth: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
            });

            document.getElementById('ph-slider').addEventListener('input', (e) => {
                const val = parseInt(e.target.value);
                const warning = document.getElementById('corrosive-warning');
                const displayBox = document.getElementById('ph-display-box');
                document.getElementById('ph-value').innerText = `pH ${val}`;
                
                let type='Neutral', color='#22c55e', ex='Pure Water', corr=false;
                let bgColor = '#f0fdf4'; // Default green-ish for neutral

                if(val < 7) { 
                    type='Acid'; color='#ef4444'; 
                    bgColor = '#fef2f2'; // Light red
                    ex = val<=2 ? 'Stomach Acid' : 'Lemon Juice'; 
                    corr = val<=2; 
                }
                else if(val > 7) { 
                    type='Alkali'; color='#3b82f6'; 
                    bgColor = '#eff6ff'; // Light blue/purple
                    ex = val>=12 ? 'Bleach' : 'Soap'; 
                    corr = val>=12; 
                }
                
                displayBox.style.backgroundColor = bgColor;
                document.getElementById('ph-type').innerText = type;
                document.getElementById('ph-type').style.color = color;
                document.getElementById('ph-example').innerText = `Example: ${ex}`;
                warning.classList.toggle('hidden', !corr);
            });
        }

        function toggleResource(id) {
            const el = document.getElementById(`${id}-details`);
            el.classList.toggle('hidden');
            el.classList.add('fade-in');
        }

        function initPhys() {
            const ctx = document.getElementById('weightChart').getContext('2d');
            window.weightChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Earth', 'Moon'],
                    datasets: [{ label: 'Weight (N)', data: [500, 80], backgroundColor: ['#3B82F6', '#FBBF24'], borderRadius: 8 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { display: false } }, x: { grid: { display: false } } } }
            });
        }

        function updateWeightChart() {
            const mass = document.getElementById('mass-input').value;
            const gravity = document.getElementById('planet-selector').value;
            const sel = document.getElementById('planet-selector');
            const planetText = sel.options[sel.selectedIndex].text.split(' ')[1];

            document.getElementById('gravity-display').innerText = gravity;

            if(!mass) return;
            window.weightChartInstance.data.labels = ['Earth', planetText];
            window.weightChartInstance.data.datasets[0].data = [(mass*10).toFixed(1), (mass*gravity).toFixed(1)];
            window.weightChartInstance.data.datasets[0].backgroundColor = ['#3B82F6', gravity > 20 ? '#EF4444' : '#FBBF24'];
            window.weightChartInstance.update();
        }

        function toggleCircuitInfo(type) {
            document.getElementById(`${type}-extra`).classList.toggle('hidden');
        }

        function initFlashcards() {
            const container = document.getElementById('flashcards-container');
            container.innerHTML = flashcards.map((card) => `
                <div class="flashcard" onclick="this.classList.toggle('flipped')">
                    <div class="flashcard-inner">
                        <div class="flashcard-front shadow-md border-2 border-gray-100 bg-white rounded-2xl">
                            <h4 class="text-xl font-bold text-gray-800 px-4">${card.q}</h4>
                            <span class="absolute bottom-4 text-xs text-cga-gold font-black tracking-widest">TAP TO FLIP</span>
                        </div>
                        <div class="flashcard-back shadow-lg bg-cga-red border-cga-red flex flex-col justify-center rounded-2xl">
                            <p class="text-xl font-bold text-white px-4">${card.a}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>
